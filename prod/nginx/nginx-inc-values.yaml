# NGINX Inc Ingress Controller - Values
# This is the FREE open-source version (not NGINX Plus)
# Supports TransportServer for TCP/TLS SNI-based routing
#
# Installation:
#   helm repo add nginx-stable https://helm.nginx.com/stable
#   helm repo update
#   helm install nginx-inc nginx-stable/nginx-ingress -n nginx-inc --create-namespace -f nginx-inc-values.yaml
#
# New LB Hostname: a86b5c59cd04443f98f1650fa1fb4348-525793824.us-east-1.elb.amazonaws.com
# DNS: Point *.falkordb.usecortex.ai to this hostname

controller:
  # Use a different ingress class to avoid conflicts with community ingress-nginx
  ingressClass:
    name: nginx-inc
    # Set to true if you want this to be the default for new Ingress resources
    setAsDefaultIngress: false

  # Enable HTTP/2 for gRPC support
  config:
    entries:
      http2: "true"
      grpc-buffer-size-kb: "65536"

  # Enable TLS passthrough for TCP/SNI routing
  enableTLSPassthrough: true

  # GlobalConfiguration for TLS passthrough listener
  globalConfiguration:
    create: true
    spec:
      listeners:
        - name: tls-passthrough
          port: 443
          protocol: TLS_PASSTHROUGH

  # Service configuration
  service:
    type: LoadBalancer
    annotations:
      # AWS NLB annotations
      service.beta.kubernetes.io/aws-load-balancer-type: "nlb"
      service.beta.kubernetes.io/aws-load-balancer-scheme: "internet-facing"
      service.beta.kubernetes.io/aws-load-balancer-cross-zone-load-balancing-enabled: "true"

  # Resource limits
  resources:
    requests:
      cpu: "100m"
      memory: "128Mi"
    limits:
      cpu: "500m"
      memory: "512Mi"

  # Replica count for HA
  replicaCount: 2

  # Pod anti-affinity for spreading across nodes
  affinity:
    podAntiAffinity:
      preferredDuringSchedulingIgnoredDuringExecution:
        - weight: 100
          podAffinityTerm:
            labelSelector:
              matchLabels:
                app.kubernetes.io/name: nginx-ingress
            topologyKey: kubernetes.io/hostname
